<Window
    x:Class="RobotControllerApp.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RobotControllerApp"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{StaticResource Brush.Background.Page}">
        
        <NavigationView x:Name="NavView" 
                        PaneDisplayMode="Left" 
                        IsBackButtonVisible="Collapsed"
                        IsSettingsVisible="False"
                        SelectionChanged="NavView_SelectionChanged" 
                        Loaded="NavView_Loaded">
            
            <NavigationView.MenuItems>
                <NavigationViewItem Content="Dashboard" Tag="home">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="Home"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                
                <NavigationViewItem Content="WhatsApp Logs" Tag="logs">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="Message"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
            </NavigationView.MenuItems>

            <NavigationView.FooterMenuItems>
                <NavigationViewItem Content="Settings" Tag="settings">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="Setting"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
            </NavigationView.FooterMenuItems>

            <!-- MAIN CONTENT AREA -->
            <Grid x:Name="ContentArea">
                
                <!-- 1. DASHBOARD VIEW -->
                <Grid x:Name="DashboardView">
                    <Border Padding="{StaticResource Padding.Page}">
                        <Grid>
                            <Grid.Resources>
                                <Storyboard x:Name="StatusPulseAnimation">
                                    <!-- Relay Outer Pulse -->
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="1.0" To="1.2" Duration="0:0:2" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="1.0" To="1.2" Duration="0:0:2" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloOuter" Storyboard.TargetProperty="Opacity" From="0.3" To="0.1" Duration="0:0:2" AutoReverse="True" RepeatBehavior="Forever"/>
                                    
                                    <!-- Robot 1 Outer Pulse -->
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="1.0" To="1.2" Duration="0:0:2.5" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="1.0" To="1.2" Duration="0:0:2.5" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloOuter" Storyboard.TargetProperty="Opacity" From="0.3" To="0.1" Duration="0:0:2.5" AutoReverse="True" RepeatBehavior="Forever"/>

                                    <!-- Robot 2 Outer Pulse -->
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="1.0" To="1.2" Duration="0:0:3" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="1.0" To="1.2" Duration="0:0:3" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloOuter" Storyboard.TargetProperty="Opacity" From="0.3" To="0.1" Duration="0:0:3" AutoReverse="True" RepeatBehavior="Forever"/>

                                    <!-- Inner Circles subtle breathing -->
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloInner" Storyboard.TargetProperty="Opacity" From="0.5" To="0.3" Duration="0:0:1.5" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloInner" Storyboard.TargetProperty="Opacity" From="0.5" To="0.3" Duration="0:0:1.8" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloInner" Storyboard.TargetProperty="Opacity" From="0.5" To="0.3" Duration="0:0:2.1" AutoReverse="True" RepeatBehavior="Forever"/>
                                </Storyboard>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/> <!-- Header -->
                                <RowDefinition Height="Auto"/> <!-- Status Cards -->
                                <RowDefinition Height="Auto"/> <!-- Video Feeds -->
                                <RowDefinition Height="*"/>    <!-- Logs & Telemetry -->
                            </Grid.RowDefinitions>

                            <!-- HEADER -->
                            <StackPanel Grid.Row="0" Margin="0,0,0,24">
                                <TextBlock Text="Telepresence Control Station" Style="{StaticResource Text.Headline1}"/>
                                <TextBlock Text="Unified Relay &amp; Console Manager" Style="{StaticResource Text.Caption}" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- STATUS CARDS -->
                            <Grid Grid.Row="1" ColumnSpacing="8" Margin="{StaticResource Margin.Card}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- RELAY SERVER -->
                                <Border Grid.Column="0" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="{StaticResource Space.8}">
                                                <FontIcon Glyph="&#xE774;" FontSize="24" Foreground="{StaticResource Brush.Status.Success}"/>
                                                <TextBlock Text="RELAY SERVER" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="RelayStatusText" Text="Initializing..." Style="{StaticResource Text.Caption}" Margin="0,8,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                                <TextBlock x:Name="RelayActiveText" Text="ACTIVE" FontWeight="Bold" Foreground="{StaticResource Brush.Status.Success}"/>
                                                <TextBlock Text="|" Opacity="0.3"/>
                                                <TextBlock x:Name="RelayLatencyText" Text="-- ms" Opacity="0.7" FontSize="12" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Modern Status Indicator -->
                                        <Grid Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                            <Ellipse x:Name="RelayHaloOuter" Width="48" Height="48" Stroke="{StaticResource Brush.Status.Success}" StrokeThickness="1" Opacity="0.2" RenderTransformOrigin="0.5,0.5">
                                                <Ellipse.RenderTransform>
                                                    <ScaleTransform/>
                                                </Ellipse.RenderTransform>
                                            </Ellipse>
                                            <Ellipse x:Name="RelayHaloInner" Width="36" Height="36" Stroke="{StaticResource Brush.Status.Success}" StrokeThickness="2" Opacity="0.4"/>
                                            <FontIcon Glyph="&#xE813;" FontSize="20" Foreground="{StaticResource Brush.Status.Success}"/>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- ROBOT 1 BRIDGE -->
                                <Border Grid.Column="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="{StaticResource Space.8}">
                                                <FontIcon x:Name="Robot1Icon" Glyph="&#xE99A;" FontSize="28" Foreground="{StaticResource Brush.Status.Warning}"/>
                                                <TextBlock Text="ROBOT 1" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="RobotStatusText" Text="Connecting..." Style="{StaticResource Text.Caption}" Margin="0,8,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                                                <TextBlock x:Name="Robot1LatencyText" Text="-- ms" Opacity="0.7" FontSize="12" VerticalAlignment="Center"/>
                                                <StackPanel x:Name="RobotConnectingState" Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="True" Width="14" Height="14" Foreground="{StaticResource Brush.Primary}"/>
                                                    <TextBlock Text="Searching..." FontSize="11" VerticalAlignment="Center" Opacity="0.6"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Modern Status Indicator -->
                                        <Grid Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                            <Ellipse x:Name="Robot1HaloOuter" Width="48" Height="48" Stroke="{Binding ElementName=Robot1Icon, Path=Foreground}" StrokeThickness="1" Opacity="0.2" RenderTransformOrigin="0.5,0.5">
                                                <Ellipse.RenderTransform>
                                                    <ScaleTransform/>
                                                </Ellipse.RenderTransform>
                                            </Ellipse>
                                            <Ellipse x:Name="Robot1HaloInner" Width="36" Height="36" Stroke="{Binding ElementName=Robot1Icon, Path=Foreground}" StrokeThickness="2" Opacity="0.4"/>
                                            <FontIcon Glyph="&#xEBC5;" FontSize="20" Foreground="{Binding ElementName=Robot1Icon, Path=Foreground}"/>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- ROBOT 2 BRIDGE -->
                                <Border Grid.Column="2" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="{StaticResource Space.8}">
                                                <FontIcon x:Name="Robot2Icon" Glyph="&#xE99A;" FontSize="28" Foreground="{StaticResource Brush.Text.Primary}"/>
                                                <TextBlock Text="ROBOT 2" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="Robot2StatusText" Text="Offline" Style="{StaticResource Text.Caption}" Margin="0,8,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                                                <TextBlock x:Name="Robot2LatencyText" Text="-- ms" Opacity="0.7" FontSize="12" VerticalAlignment="Center"/>
                                                <StackPanel x:Name="Robot2ConnectingState" Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="True" Width="14" Height="14" Foreground="{StaticResource Brush.Primary}"/>
                                                    <TextBlock Text="Searching..." FontSize="11" VerticalAlignment="Center" Opacity="0.6"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Modern Status Indicator -->
                                        <Grid Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                            <Ellipse x:Name="Robot2HaloOuter" Width="48" Height="48" Stroke="{Binding ElementName=Robot2Icon, Path=Foreground}" StrokeThickness="1" Opacity="0.2" RenderTransformOrigin="0.5,0.5">
                                                <Ellipse.RenderTransform>
                                                    <ScaleTransform/>
                                                </Ellipse.RenderTransform>
                                            </Ellipse>
                                            <Ellipse x:Name="Robot2HaloInner" Width="36" Height="36" Stroke="{Binding ElementName=Robot2Icon, Path=Foreground}" StrokeThickness="2" Opacity="0.4"/>
                                            <FontIcon Glyph="&#xEBC5;" FontSize="20" Foreground="{Binding ElementName=Robot2Icon, Path=Foreground}"/>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </Grid>

                            <!-- VIDEO FEEDS -->
                            <Grid Grid.Row="2" ColumnSpacing="24" Margin="0,0,0,24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Robot Feed -->
                                <Border Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="16">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="320"/>
                                        </Grid.RowDefinitions>
                                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                                            <FontIcon Glyph="&#xE99A;" FontSize="18" Foreground="{StaticResource Brush.Primary}"/>
                                            <TextBlock Text="ROBOT PRIMARY FEED (REMOTE)" FontWeight="SemiBold"/>
                                        </StackPanel>
                                        <Border Grid.Row="1" Background="Black" CornerRadius="8">
                                            <Grid>
                                                <Image x:Name="CameraImage" Stretch="Uniform"/>
                                                <StackPanel x:Name="CameraOfflineState" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                     <SymbolIcon Symbol="Camera" Foreground="Gray" Margin="0,0,0,8"/>
                                                     <TextBlock Text="Waiting for stream..." Foreground="Gray" FontSize="11"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </Border>

                                <!-- Local Webcam -->
                                <Border Grid.Column="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="16">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="320"/>
                                        </Grid.RowDefinitions>
                                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                                            <FontIcon Glyph="&#xE722;" FontSize="18" Foreground="#0078D7"/>
                                            <TextBlock Text="OPERATOR WEBCAM (LOCAL)" FontWeight="SemiBold"/>
                                        </StackPanel>
                                        <Border Grid.Row="1" Background="Black" CornerRadius="8">
                                            <Image x:Name="LocalWebcamPreview" Stretch="Uniform"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </Grid>

                            <!-- LOGS & TELEMETRY -->
                            <Grid Grid.Row="3" ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.5*"/> <!-- Logs -->
                                    <ColumnDefinition Width="2.5*"/> <!-- Dashboard -->
                                </Grid.ColumnDefinitions>

                                <!-- LEFT: System Logs -->
                                <Grid Grid.Column="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="System Logs" Style="{StaticResource Text.Headline3}" Margin="{StaticResource Margin.Component}"/>
                                    <Border Grid.Row="1" Background="Black" CornerRadius="{StaticResource Radius.Small}" Padding="{StaticResource Padding.Small}">
                                        <ScrollViewer>
                                            <RichTextBlock x:Name="ConsoleLog" IsTextSelectionEnabled="True" Foreground="#00FF00" FontFamily="Consolas" FontSize="12"/>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>

                                <!-- RIGHT: Detailed Telemetry -->
                                <Grid Grid.Column="1">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="Live Telemetry" Style="{StaticResource Text.Headline3}" Margin="{StaticResource Margin.Component}"/>
                                    
                                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                        <Grid RowSpacing="16" ColumnSpacing="16">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- 1. Robot State Card -->
                                            <Border Grid.Row="0" Grid.Column="0" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Small}" Padding="16">
                                                <StackPanel Spacing="12">
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE99A;" Foreground="{StaticResource Brush.Primary}"/>
                                                        <TextBlock Text="Robot 1" FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="Joints:" Opacity="0.6" Margin="0,0,8,0"/>
                                                        <TextBlock x:Name="TelemJoints" Text="[0, 0, 0, 0, 0, 0]" Grid.Column="1" TextWrapping="Wrap" FontSize="12" FontFamily="Consolas"/>
                                                    </Grid>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="Gripper:" Opacity="0.6" Margin="0,0,8,0"/>
                                                        <TextBlock x:Name="TelemGripper" Text="Unknown" Grid.Column="1" FontWeight="Bold"/>
                                                    </Grid>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="Mode:" Opacity="0.6" Margin="0,0,8,0"/>
                                                        <TextBlock x:Name="TelemMode" Text="Standard" Grid.Column="1"/>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>

                                            <!-- 2. Unity / Headset Card -->
                                            <Border Grid.Row="0" Grid.Column="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Small}" Padding="16">
                                                <StackPanel Spacing="12">
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE7F4;" Foreground="#0078D7"/>
                                                        <TextBlock Text="Unity / Headset" FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                    <TextBlock Text="Last IK Solution:" Opacity="0.6" FontSize="10"/>
                                                    <TextBlock x:Name="TelemIKPos" Text="Pos: [0.00, 0.00, 0.00]" FontFamily="Consolas" FontSize="12"/>
                                                    <TextBlock x:Name="TelemIKRot" Text="Rot: [0.00, 0.00, 0.00, 1.00]" FontFamily="Consolas" FontSize="12"/>
                                                    <Border Height="1" Background="#FFFFFF" Opacity="0.1" Margin="0,4"/>
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <TextBlock Text="Latency:" Opacity="0.6"/>
                                                        <TextBlock x:Name="TelemUnityLatency" Text="-- ms" Foreground="#0078D7"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>

                                            <!-- 3. Media Stats Card -->
                                            <Border Grid.Row="1" Grid.Column="0" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Small}" Padding="16">
                                                <StackPanel Spacing="12">
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE722;" Foreground="#FFD279"/> <!-- Camera -->
                                                        <TextBlock Text="Media Stream" FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                    <Grid>
                                                         <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock Text="FPS" Opacity="0.6" FontSize="10"/>
                                                            <TextBlock x:Name="TelemFps" Text="0" FontSize="20"/>
                                                        </StackPanel>
                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock Text="Total Sent" Opacity="0.6" FontSize="10"/>
                                                            <TextBlock x:Name="TelemTotalImages" Text="0" FontSize="20"/>
                                                        </StackPanel>
                                                    </Grid>
                                                    <ProgressBar x:Name="TelemBufferBar" Value="0" Maximum="100" Height="4"/>
                                                    <TextBlock Text="Buffer Health" HorizontalAlignment="Right" FontSize="10" Opacity="0.5"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- 4. Communication Card -->
                                            <Border Grid.Row="1" Grid.Column="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Small}" Padding="16">
                                                <StackPanel Spacing="12">
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE8BD;" Foreground="#25D366"/>
                                                        <TextBlock Text="Communication" FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                    <TextBlock Text="Last Command Received:" Opacity="0.6" FontSize="10"/>
                                                    <TextBlock x:Name="TelemLastCmd" Text="-"  TextWrapping="Wrap" MaxLines="2" TextTrimming="CharacterEllipsis" FontStyle="Italic"/>
                                                    <Border Height="1" Background="#FFFFFF" Opacity="0.1" Margin="0,4"/>
                                                    <Grid>
                                                        <TextBlock Text="Source:" Opacity="0.6"/>
                                                        <TextBlock x:Name="TelemCmdSource" Text="System" HorizontalAlignment="Right" Foreground="#25D366"/>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>

                                        </Grid>
                                    </ScrollViewer>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>


                <!-- 3. LOGS VIEW (WhatsApp) -->
                <Grid x:Name="LogsView" Visibility="Collapsed">
                    <Border Padding="{StaticResource Padding.Page}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="WhatsApp Interaction History" Style="{StaticResource Text.Headline1}"/>
                            
                            <Border Grid.Row="1" Background="#111B21" CornerRadius="{StaticResource Radius.Small}" Margin="0,16,0,0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Chat Area -->
                                    <Grid>
                                        <ScrollViewer x:Name="ChatScrollViewer" Padding="0,10" ViewChanged="ChatScrollViewer_ViewChanged">
                                            <StackPanel x:Name="ChatHistoryPanel" Padding="16" Spacing="12"/>
                                        </ScrollViewer>

                                        <Button x:Name="NewMessageBadge" 
                                                Visibility="Collapsed" 
                                                VerticalAlignment="Bottom" 
                                                HorizontalAlignment="Center" 
                                                Margin="0,0,0,12" 
                                                Style="{StaticResource Button.Primary}"
                                                CornerRadius="16"
                                                Click="NewMessageBadge_Click">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE70D;" FontSize="12"/>
                                                <TextBlock x:Name="NewMessageCountText" Text="New Message"/>
                                            </StackPanel>
                                        </Button>
                                    </Grid>

                                    <!-- Simulator Area -->
                                    <Border Grid.Row="1" Background="#202C33" CornerRadius="0,0,8,8">
                                        <StackPanel Padding="16" Spacing="16">
                                            <!-- Info Box -->
                                            <Border Background="#2A3942" CornerRadius="8" Padding="12">
                                                <StackPanel Orientation="Horizontal" Spacing="12">
                                                    <FontIcon Glyph="&#xE946;" FontSize="16" Foreground="#FFD279"/>
                                                    <StackPanel>
                                                        <TextBlock Text="Command Simulator" FontWeight="Bold" Foreground="#E9EDEF"/>
                                                        <TextBlock Text="Test robot commands (e.g., 'home', 'wave') directly here without using WhatsApp." Foreground="#8696A0" FontSize="12"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>

                                            <!-- Quick Commands -->
                                            <ScrollViewer HorizontalScrollBarVisibility="Auto" HorizontalScrollMode="Enabled" VerticalScrollMode="Disabled">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <Button Content="ðŸ  Home" Click="QuickCommand_Click" Tag="home" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="ðŸ‘‹ Wave" Click="QuickCommand_Click" Tag="wave" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="ðŸ“¸ Photo" Click="QuickCommand_Click" Tag="photo" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="ðŸ…¿ï¸ Park" Click="QuickCommand_Click" Tag="park" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="âœŠ Grab" Click="QuickCommand_Click" Tag="grab" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="ðŸ‘ Release" Click="QuickCommand_Click" Tag="release" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="âš™ï¸ Calibrate" Click="QuickCommand_Click" Tag="calibrate" Style="{StaticResource Button.Secondary}"/>
                                                    <Button Content="ðŸŸ¢ Status" Click="QuickCommand_Click" Tag="status" Style="{StaticResource Button.Secondary}"/>
                                                </StackPanel>
                                            </ScrollViewer>

                                            <!-- Input -->
                                            <Grid ColumnSpacing="10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBox x:Name="SimulatorInput" PlaceholderText="Type a message..." KeyDown="SimulatorInput_KeyDown"/>
                                                <Button x:Name="SimulateButton" Content="SEND" Style="{StaticResource Button.Primary}" Click="SimulateButton_Click" Grid.Column="1"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>

                <!-- 5. NETWORK VIEW -->
                <Grid x:Name="NetworkView" Visibility="Collapsed">
                    <Border Padding="{StaticResource Padding.Page}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Network &amp; Latency" Style="{StaticResource Text.Headline1}" Margin="0,0,0,24"/>

                            <!-- Speed Test Section -->
                            <Border Grid.Row="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}" Margin="0,0,0,24" HorizontalAlignment="Left" MinWidth="500">
                                <StackPanel Spacing="16">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE9D2;" FontSize="20" Foreground="{StaticResource Brush.Primary}"/>
                                        <TextBlock Text="Internet Speed Test" Style="{StaticResource Text.Headline3}"/>
                                    </StackPanel>
                                    
                                    <Grid ColumnSpacing="24">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="LATENCY" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                            <TextBlock Text="-- ms" FontSize="24" FontWeight="SemiBold" x:Name="InternetLatencyText"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="DOWNLOAD" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                            <TextBlock Text="-- Mbps" FontSize="24" FontWeight="SemiBold" x:Name="InternetSpeedText" Foreground="{StaticResource Brush.Primary}"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="STATUS" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                            <TextBlock Text="Idle" FontSize="18" FontWeight="SemiBold" x:Name="NetworkStatusText"/>
                                        </StackPanel>
                                        
                                        <Button Grid.Column="3" Content="Run Test" Style="{StaticResource Button.Primary}" VerticalAlignment="Center" Click="RunSpeedTest_Click"/>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Node Graph -->
                            <Grid Grid.Row="2" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="32">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/> <!-- Cloud -->
                                    <RowDefinition Height="100"/>  <!-- Link -->
                                    <RowDefinition Height="Auto"/> <!-- PC -->
                                    <RowDefinition Height="100"/>  <!-- Links -->
                                    <RowDefinition Height="Auto"/> <!-- Devices -->
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Cloudflare -->
                                <StackPanel Grid.Row="0" Grid.Column="1" HorizontalAlignment="Center" Spacing="4">
                                    <Border Width="60" Height="60" CornerRadius="30" Background="#2D2D30" BorderBrush="#F48024" BorderThickness="2">
                                        <FontIcon Glyph="&#xE753;" FontSize="24" Foreground="#F48024" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Text="Cloudflare" HorizontalAlignment="Center" FontWeight="Bold"/>
                                    <TextBlock x:Name="GraphCloudPing" Text="-- ms" HorizontalAlignment="Center" Foreground="#F48024"/>
                                </StackPanel>

                                <!-- Vertical Line -->
                                <Rectangle Grid.Row="1" Grid.Column="1" Width="2" Fill="#404040"/>

                                <!-- Controller -->
                                <StackPanel Grid.Row="2" Grid.Column="1" HorizontalAlignment="Center" Spacing="4">
                                    <Border Width="80" Height="80" CornerRadius="40" Background="#F48024" BorderBrush="White" BorderThickness="2">
                                        <FontIcon Glyph="&#xE950;" FontSize="32" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Text="This PC" HorizontalAlignment="Center" FontWeight="Bold" FontSize="16"/>
                                </StackPanel>

                                <!-- Diagonal Lines via Grid/Path is hard, using simple Layout -->
                                <Grid Grid.Row="3" Grid.ColumnSpan="3">
                                    <Path Stroke="#404040" StrokeThickness="2" Data="M 200,100 L 400,0 L 600,100" HorizontalAlignment="Center" Stretch="Fill" Width="400" Height="100"/>
                                </Grid>

                                <!-- Robot -->
                                <StackPanel Grid.Row="4" Grid.Column="0" HorizontalAlignment="Center" Spacing="4">
                                    <Border Width="60" Height="60" CornerRadius="30" Background="#2D2D30" BorderBrush="{StaticResource Brush.Primary}" BorderThickness="2">
                                        <FontIcon Glyph="&#xE99A;" FontSize="24" Foreground="{StaticResource Brush.Primary}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Text="Robot" HorizontalAlignment="Center" FontWeight="Bold"/>
                                    <TextBlock x:Name="GraphRobotPing" Text="-- ms" HorizontalAlignment="Center" Foreground="{StaticResource Brush.Primary}"/>
                                </StackPanel>

                                <!-- Unity -->
                                <StackPanel Grid.Row="4" Grid.Column="2" HorizontalAlignment="Center" Spacing="4">
                                    <Border Width="60" Height="60" CornerRadius="30" Background="#2D2D30" BorderBrush="#0078D7" BorderThickness="2">
                                        <FontIcon Glyph="&#xE7F4;" FontSize="24" Foreground="#0078D7" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Text="Unity Client" HorizontalAlignment="Center" FontWeight="Bold"/>
                                    <TextBlock x:Name="GraphUnityPing" Text="-- ms" HorizontalAlignment="Center" Foreground="#0078D7"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <!-- 4. SETTINGS VIEW -->
                <Grid x:Name="SettingsView" Visibility="Collapsed">
                    <Border Padding="{StaticResource Padding.Page}">
                        <StackPanel Spacing="{StaticResource Space.24}" MaxWidth="600" HorizontalAlignment="Left">
                            <TextBlock Text="Settings" Style="{StaticResource Text.Headline1}"/>
                            
                            <!-- Relay Settings -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Relay Server Port" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="RelayPortInput" PlaceholderText="5000" MinWidth="300"/>
                                <TextBlock Text="The internal port where the relay server listens." Style="{StaticResource Text.Caption}" Opacity="0.6"/>
                            </StackPanel>

                            <StackPanel Spacing="8">
                                <TextBlock Text="Cloudflare Tunnel / Public URL" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="PublicUrlInput" PlaceholderText="https://teleop.dmzs-lab.com" MinWidth="300"/>
                                <TextBlock Text="The public address (Cloudflare) used for external connectivity (Unity, Web, Twilio)." Style="{StaticResource Text.Caption}" Opacity="0.6"/>
                            </StackPanel>

                            <!-- Robot Settings -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Robot 1 IP Address (ROS Bridge)" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="RobotIpInput" PlaceholderText="ws://169.254.200.200:9090" MinWidth="300"/>
                            </StackPanel>

                            <StackPanel Spacing="8">
                                <TextBlock Text="Robot 2 IP Address (ROS Bridge)" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="Robot2IpInput" PlaceholderText="ws://169.254.200.201:9090" MinWidth="300"/>
                            </StackPanel>


                            
                            <Button x:Name="SaveSettingsButton" Content="SAVE &amp; RESTART RELAY" Style="{StaticResource Button.Filled}" HorizontalAlignment="Left" Click="SaveSettingsButton_Click" Margin="0,16,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </NavigationView>
    </Grid>
</Window>
