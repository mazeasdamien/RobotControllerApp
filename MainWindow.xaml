<Window
    x:Class="RobotControllerApp.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RobotControllerApp"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{StaticResource Brush.Background.Page}">
        
        <NavigationView x:Name="NavView" 
                        PaneDisplayMode="Left" 
                        IsBackButtonVisible="Collapsed"
                        IsSettingsVisible="False"
                        SelectionChanged="NavView_SelectionChanged" 
                        Loaded="NavView_Loaded">
            

            <NavigationView.MenuItems>
                <NavigationViewItem Content="Dashboard" Tag="home">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="Home"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>

                <NavigationViewItem Content="Telemetry" Tag="telemetry">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="FourBars"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>

                <NavigationViewItem Content="Networks" Tag="network">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="World"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
            </NavigationView.MenuItems>

            <NavigationView.FooterMenuItems>
                <NavigationViewItem Content="Settings" Tag="settings">
                    <NavigationViewItem.Icon>
                        <SymbolIcon Symbol="Setting"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
            </NavigationView.FooterMenuItems>

            <!-- MAIN CONTENT AREA -->
            <Grid x:Name="ContentArea">
                
                <!-- 1. DASHBOARD VIEW -->
                <Grid x:Name="DashboardView">
                    <Border Padding="{StaticResource Padding.Page}">
                        <Grid>
                            <Grid.Resources>
                                <Storyboard x:Name="StatusPulseAnimation">
                                    <!-- Relay Outer Pulse -->
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="1.0" To="1.2" Duration="0:0:2" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="1.0" To="1.2" Duration="0:0:2" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloOuter" Storyboard.TargetProperty="Opacity" From="0.3" To="0.1" Duration="0:0:2" AutoReverse="True" RepeatBehavior="Forever"/>
                                    
                                    <!-- Robot 1 Outer Pulse -->
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="1.0" To="1.2" Duration="0:0:2.5" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="1.0" To="1.2" Duration="0:0:2.5" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloOuter" Storyboard.TargetProperty="Opacity" From="0.3" To="0.1" Duration="0:0:2.5" AutoReverse="True" RepeatBehavior="Forever"/>

                                    <!-- Robot 2 Outer Pulse -->
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="1.0" To="1.2" Duration="0:0:3" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloOuter" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="1.0" To="1.2" Duration="0:0:3" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloOuter" Storyboard.TargetProperty="Opacity" From="0.3" To="0.1" Duration="0:0:3" AutoReverse="True" RepeatBehavior="Forever"/>

                                    <!-- Inner Circles subtle breathing -->
                                    <DoubleAnimation Storyboard.TargetName="RelayHaloInner" Storyboard.TargetProperty="Opacity" From="0.5" To="0.3" Duration="0:0:1.5" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot1HaloInner" Storyboard.TargetProperty="Opacity" From="0.5" To="0.3" Duration="0:0:1.8" AutoReverse="True" RepeatBehavior="Forever"/>
                                    <DoubleAnimation Storyboard.TargetName="Robot2HaloInner" Storyboard.TargetProperty="Opacity" From="0.5" To="0.3" Duration="0:0:2.1" AutoReverse="True" RepeatBehavior="Forever"/>
                                </Storyboard>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/> <!-- Header -->
                                <RowDefinition Height="Auto"/> <!-- Status Cards -->
                                <RowDefinition Height="Auto"/> <!-- Video Feeds -->
                                <RowDefinition Height="*"/>    <!-- Logs & Telemetry -->
                            </Grid.RowDefinitions>

                            <!-- HEADER REMOVED -->

                            <!-- STATUS CARDS -->
                            <Grid Grid.Row="1" ColumnSpacing="8" Margin="{StaticResource Margin.Card}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- RELAY SERVER -->
                                <Border Grid.Column="0" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="{StaticResource Space.8}">
                                                <FontIcon x:Name="RelayIcon" Glyph="&#xE774;" FontSize="24" Foreground="{StaticResource Brush.Text.Muted}"/>
                                                <TextBlock Text="EXPERT INTERFACE (QUEST 3)" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="RelayStatusText" Text="Listening for Quest 3..." Style="{StaticResource Text.Caption}" Margin="0,8,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                                <TextBlock x:Name="RelayActiveText" Text="STANDBY" FontWeight="Bold" Foreground="{StaticResource Brush.Text.Muted}"/>
                                                <TextBlock Text="|" Opacity="0.3" Visibility="Collapsed"/>
                                                <TextBlock x:Name="RelayLatencyText" Text="--" Opacity="0.7" FontSize="12" VerticalAlignment="Center" Visibility="Collapsed"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Modern Status Indicator -->
                                        <Grid Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                            <Ellipse x:Name="RelayHaloOuter" Width="48" Height="48" Stroke="{Binding ElementName=RelayActiveText, Path=Foreground}" StrokeThickness="1" Opacity="0.2" RenderTransformOrigin="0.5,0.5">
                                                <Ellipse.RenderTransform>
                                                    <ScaleTransform/>
                                                </Ellipse.RenderTransform>
                                            </Ellipse>
                                            <Ellipse x:Name="RelayHaloInner" Width="36" Height="36" Stroke="{Binding ElementName=RelayActiveText, Path=Foreground}" StrokeThickness="2" Opacity="0.4"/>
                                            <FontIcon x:Name="RelayHaloIcon" Glyph="&#xE813;" FontSize="20" Foreground="{Binding ElementName=RelayActiveText, Path=Foreground}"/>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- ROBOT 1 BRIDGE -->
                                <Border Grid.Column="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="{StaticResource Space.8}">
                                                <FontIcon x:Name="Robot1Icon" Glyph="&#xE99A;" FontSize="28" Foreground="{StaticResource Brush.Status.Warning}"/>
                                                <TextBlock Text="ROBOT 1" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="RobotStatusText" Text="Connecting..." Style="{StaticResource Text.Caption}" Margin="0,8,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                                                <TextBlock x:Name="Robot1LatencyText" Text="--" Opacity="0.7" FontSize="12" VerticalAlignment="Center" Visibility="Collapsed"/>
                                                <StackPanel x:Name="RobotConnectingState" Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="True" Width="14" Height="14" Foreground="{StaticResource Brush.Primary}"/>
                                                    <TextBlock Text="Searching..." FontSize="11" VerticalAlignment="Center" Opacity="0.6"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Modern Status Indicator -->
                                        <Grid Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                            <Ellipse x:Name="Robot1HaloOuter" Width="48" Height="48" Stroke="{Binding ElementName=Robot1Icon, Path=Foreground}" StrokeThickness="1" Opacity="0.2" RenderTransformOrigin="0.5,0.5">
                                                <Ellipse.RenderTransform>
                                                    <ScaleTransform/>
                                                </Ellipse.RenderTransform>
                                            </Ellipse>
                                            <Ellipse x:Name="Robot1HaloInner" Width="36" Height="36" Stroke="{Binding ElementName=Robot1Icon, Path=Foreground}" StrokeThickness="2" Opacity="0.4"/>
                                            <FontIcon Glyph="&#xEBC5;" FontSize="20" Foreground="{Binding ElementName=Robot1Icon, Path=Foreground}"/>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- ROBOT 2 BRIDGE -->
                                <Border Grid.Column="2" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="{StaticResource Space.8}">
                                                <FontIcon x:Name="Robot2Icon" Glyph="&#xE99A;" FontSize="28" Foreground="{StaticResource Brush.Text.Primary}"/>
                                                <TextBlock Text="ROBOT 2" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="Robot2StatusText" Text="Offline" Style="{StaticResource Text.Caption}" Margin="0,8,0,0"/>
                                            <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                                                <TextBlock x:Name="Robot2LatencyText" Text="--" Opacity="0.7" FontSize="12" VerticalAlignment="Center" Visibility="Collapsed"/>
                                                <StackPanel x:Name="Robot2ConnectingState" Orientation="Horizontal" Spacing="8">
                                                    <ProgressRing IsActive="True" Width="14" Height="14" Foreground="{StaticResource Brush.Primary}"/>
                                                    <TextBlock Text="Searching..." FontSize="11" VerticalAlignment="Center" Opacity="0.6"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Modern Status Indicator -->
                                        <Grid Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                            <Ellipse x:Name="Robot2HaloOuter" Width="48" Height="48" Stroke="{Binding ElementName=Robot2Icon, Path=Foreground}" StrokeThickness="1" Opacity="0.2" RenderTransformOrigin="0.5,0.5">
                                                <Ellipse.RenderTransform>
                                                    <ScaleTransform/>
                                                </Ellipse.RenderTransform>
                                            </Ellipse>
                                            <Ellipse x:Name="Robot2HaloInner" Width="36" Height="36" Stroke="{Binding ElementName=Robot2Icon, Path=Foreground}" StrokeThickness="2" Opacity="0.4"/>
                                            <FontIcon Glyph="&#xEBC5;" FontSize="20" Foreground="{Binding ElementName=Robot2Icon, Path=Foreground}"/>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </Grid>

                            <!-- VIDEO FEEDS — fixed height so both cards are always equal -->
                            <Grid Grid.Row="2" ColumnSpacing="24" Margin="0,0,0,24" Height="360">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- ── ROBOT 1 VIDEO FEED ─────────────────────────────────────────── -->
                                <Border Background="{StaticResource Brush.Background.Card}"
                                        CornerRadius="{StaticResource Radius.Medium}"
                                        Padding="16">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Header -->
                                        <Grid Margin="0,0,0,12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                                <FontIcon Glyph="&#xE99A;" FontSize="16" Foreground="{StaticResource Brush.Primary}"/>
                                                <TextBlock Text="ROBOT 1 VIDEO FEED" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <!-- LIVE badge -->
                                            <Border Grid.Column="2" CornerRadius="4" Padding="6,2"
                                                    x:Name="RobotFeedBadge"
                                                    Background="#1A3A1A" VerticalAlignment="Center">
                                                <StackPanel Orientation="Horizontal" Spacing="5">
                                                    <Ellipse Width="6" Height="6" Fill="#4CAF50"
                                                             x:Name="RobotFeedDot"/>
                                                    <TextBlock x:Name="RobotFeedBadgeText"
                                                               Text="OFFLINE" FontSize="10"
                                                               Foreground="#4CAF50" FontWeight="SemiBold"/>
                                                </StackPanel>
                                            </Border>
                                        </Grid>

                                        <!-- Preview -->
                                        <Border Grid.Row="1" Background="#0A0A0A" CornerRadius="10"
                                                BorderBrush="#1E1E1E" BorderThickness="1">
                                            <Grid>
                                                <Image x:Name="CameraImage" Stretch="UniformToFill"
                                                       Visibility="Collapsed"/>
                                                <StackPanel x:Name="CameraOfflineState"
                                                            VerticalAlignment="Center"
                                                            HorizontalAlignment="Center" Spacing="6">
                                                    <FontIcon Glyph="&#xE99A;" FontSize="32"
                                                              Foreground="#333333"/>
                                                    <TextBlock Text="Waiting for video stream..."
                                                               Foreground="#444444" FontSize="11"
                                                               HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </Border>

                                <!-- ── OPERATOR WEBCAM ────────────────────────────────────────────── -->
                                <Border Grid.Column="1"
                                        Background="{StaticResource Brush.Background.Card}"
                                        CornerRadius="{StaticResource Radius.Medium}"
                                        Padding="16">
                                    <Grid>
                                        <!-- Grid rows: title | dropdown | preview -->
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Header row 1: icon + title -->
                                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                                            <FontIcon Glyph="&#xE722;" FontSize="16"
                                                      Foreground="#0078D7" VerticalAlignment="Center"/>
                                            <TextBlock Text="OPERATOR WEBCAM"
                                                       FontWeight="SemiBold" FontSize="12"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- Header row 2: camera dropdown + refresh -->
                                        <Grid Grid.Row="1" Margin="0,0,0,12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <ComboBox x:Name="CameraComboBox"
                                                      PlaceholderText="Select camera..."
                                                      HorizontalAlignment="Stretch"
                                                      SelectionChanged="CameraComboBox_SelectionChanged"
                                                      FontSize="11"
                                                      Height="32"
                                                      CornerRadius="6"/>

                                            <Button Grid.Column="1"
                                                    x:Name="RefreshCamerasButton"
                                                    Padding="8"
                                                    Margin="6,0,0,0"
                                                    ToolTipService.ToolTip="Refresh camera list"
                                                    Click="RefreshCamerasButton_Click"
                                                    CornerRadius="6"
                                                    Background="Transparent"
                                                    BorderBrush="#333333"
                                                    VerticalAlignment="Center">
                                                <FontIcon Glyph="&#xE72C;" FontSize="13"/>
                                            </Button>
                                        </Grid>

                                        <!-- Preview — CaptureElement works with USB webcams -->
                                        <Border Grid.Row="2" Background="#0A0A0A" CornerRadius="10"
                                                BorderBrush="#1E1E1E" BorderThickness="1">
                                            <MediaPlayerElement x:Name="LocalWebcamPreview"
                                                                Stretch="Uniform" AutoPlay="False"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </Grid>

                            <!-- LOGS & TELEMETRY -->
                            <!-- LOGS & MINIMAL FEEDBACK -->
                            <Grid Grid.Row="3" ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- System Logs -->
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="System Logs" Style="{StaticResource Text.Headline3}" Margin="{StaticResource Margin.Component}"/>
                                    <Border Grid.Row="1" Background="Black" CornerRadius="{StaticResource Radius.Small}" Padding="{StaticResource Padding.Small}">
                                        <ScrollViewer>
                                            <RichTextBlock x:Name="ConsoleLog" IsTextSelectionEnabled="True" Foreground="#00FF00" FontFamily="Consolas" FontSize="12"/>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <!-- 2. EXPERT TELEMETRY VIEW -->
                <Grid x:Name="TelemetryView" Visibility="Collapsed">
                    <Border Padding="{StaticResource Padding.Page}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- HEADER REMOVED -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <Grid RowSpacing="24" ColumnSpacing="24">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 1. Robot Core State -->
                                    <Border Grid.Row="0" Grid.Column="0" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="24">
                                        <StackPanel Spacing="16">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE99A;" FontSize="20" Foreground="{StaticResource Brush.Primary}"/>
                                                <TextBlock Text="Local Robot State" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <StackPanel Spacing="12">
                                                <Grid>
                                                    <TextBlock Text="Joint Configuration" Opacity="0.6"/>
                                                    <TextBlock x:Name="TelemJoints" Text="[0, 0, 0, 0, 0, 0]" HorizontalAlignment="Right" FontFamily="Consolas"/>
                                                </Grid>
                                                <Border Height="1" Background="White" Opacity="0.1"/>
                                                <Grid>
                                                    <TextBlock Text="End Effector (Gripper)" Opacity="0.6"/>
                                                    <TextBlock x:Name="TelemGripper" Text="Unknown" HorizontalAlignment="Right" FontWeight="Bold" Foreground="{StaticResource Brush.Primary}"/>
                                                </Grid>
                                                <Border Height="1" Background="White" Opacity="0.1"/>
                                                <Grid>
                                                    <TextBlock Text="Operational Mode" Opacity="0.6"/>
                                                    <TextBlock x:Name="TelemMode" Text="Standard / Teleop" HorizontalAlignment="Right"/>
                                                </Grid>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- 2. IK Solver Feed (From Quest 3) -->
                                    <Border Grid.Row="0" Grid.Column="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="24">
                                        <StackPanel Spacing="16">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE7F4;" FontSize="20" Foreground="#0078D7"/>
                                                <TextBlock Text="IK Matrix Solutions" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <StackPanel Spacing="12">
                                                <TextBlock Text="Target Pose (World Coordinates)" Opacity="0.6"/>
                                                <Border Background="Black" Padding="12" CornerRadius="8">
                                                    <StackPanel>
                                                        <TextBlock x:Name="TelemIKPos" Text="Pos: [0.00, 0.00, 0.00]" FontFamily="Consolas" FontSize="14" Foreground="#00FF00"/>
                                                        <TextBlock x:Name="TelemIKRot" Text="Rot: [0.00, 0.00, 0.00, 1.00]" FontFamily="Consolas" FontSize="14" Foreground="#00FF00" Margin="0,4,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- 3. Network Media Performance -->
                                    <Border Grid.Row="1" Grid.Column="0" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="24">
                                        <StackPanel Spacing="16">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE722;" FontSize="20" Foreground="#FFD279"/>
                                                <TextBlock Text="Media Pipeline" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            <Grid ColumnSpacing="24">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel>
                                                    <TextBlock Text="Throughput" Opacity="0.6" FontSize="11"/>
                                                    <TextBlock x:Name="TelemFps" Text="0.0" FontSize="32" FontWeight="Bold"/>
                                                    <TextBlock Text="Frames / Second" FontSize="10" Opacity="0.5"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="Total Transmission" Opacity="0.6" FontSize="11"/>
                                                    <TextBlock x:Name="TelemTotalImages" Text="0" FontSize="32" FontWeight="Bold" Foreground="#FFD279"/>
                                                    <TextBlock Text="Encoded Images" FontSize="10" Opacity="0.5"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Border>


                                </Grid>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>


                            <!-- 5. NETWORK VIEW -->
                <Grid x:Name="NetworkView" Visibility="Collapsed">
                    <Border Padding="{StaticResource Padding.Page}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Orientation="Horizontal" Spacing="16" Margin="0,0,0,24" Visibility="Collapsed">
                                    <Image Source="ms-appx:///Assets/AppLogo.png" Width="36" Height="36"/>
                                    <TextBlock Text="Network &amp; Latency" Style="{StaticResource Text.Headline1}" VerticalAlignment="Center"/>
                                </StackPanel>

                                <!-- Speed Test Section -->
                                <Border Grid.Row="1" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="{StaticResource Padding.Card}" Margin="0,0,0,24" HorizontalAlignment="Stretch">
                                    <Grid ColumnSpacing="32">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="420"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Spacing="16">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                            <FontIcon Glyph="&#xE81E;" FontSize="20" Foreground="{StaticResource Brush.Primary}"/>
                                            <TextBlock Text="Internet Performance Test" Style="{StaticResource Text.Headline3}"/>
                                        </StackPanel>
                                            
                                            <Grid ColumnSpacing="16">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,16">
                                                    <TextBlock Text="LATENCY" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                                    <TextBlock Text="-- ms" FontSize="20" FontWeight="SemiBold" x:Name="InternetLatencyText" Margin="0,0,0,4"/>
                                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                                        <StackPanel>
                                                            <TextBlock Text="MIN" FontSize="9" Opacity="0.5"/>
                                                            <TextBlock x:Name="InternetMinText" Text="--" FontSize="11" FontWeight="Bold"/>
                                                        </StackPanel>
                                                        <StackPanel>
                                                            <TextBlock Text="MAX" FontSize="9" Opacity="0.5"/>
                                                            <TextBlock x:Name="InternetMaxText" Text="--" FontSize="11" FontWeight="Bold"/>
                                                        </StackPanel>
                                                        <StackPanel>
                                                            <TextBlock Text="AVG" FontSize="9" Opacity="0.5"/>
                                                            <TextBlock x:Name="InternetAvgText" Text="--" FontSize="11" FontWeight="Bold" Foreground="#00E5FF"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </StackPanel>

                                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,0,16">
                                                    <TextBlock Text="DOWNLOAD" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                                    <TextBlock Text="-- Mbps" FontSize="20" FontWeight="SemiBold" x:Name="InternetSpeedText" Foreground="{StaticResource Brush.Primary}"/>
                                                </StackPanel>
                                                <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,16">
                                                    <TextBlock Text="UPLOAD" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                                    <TextBlock Text="-- Mbps" FontSize="20" FontWeight="SemiBold" x:Name="InternetUploadText" Foreground="#D279FF"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                                                    <TextBlock Text="STATUS" Style="{StaticResource Text.Caption}" Opacity="0.7"/>
                                                    <TextBlock Text="Idle" FontSize="16" FontWeight="SemiBold" x:Name="NetworkStatusText"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" VerticalAlignment="Center" HorizontalAlignment="Right" Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="AUTO-MONITORING" FontSize="11" FontWeight="Bold" Foreground="{StaticResource Brush.Text.Muted}" VerticalAlignment="Center" Opacity="0.8"/>
                                                    <ToggleSwitch x:Name="AutoMonitorToggle" IsOn="True" OnContent="Active" OffContent="Paused" MinWidth="0" Margin="0,0,0,-8" Toggled="AutoMonitorToggle_Toggled"/>
                                                </StackPanel>
                                                <Button x:Name="RunSpeedTestButton" Visibility="Collapsed" IsEnabled="True"/>
                                            </Grid>

                                            <!-- Speed Stats -->
                                            <Border Background="Black" Opacity="0.3" Height="1" Margin="0,8"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel>
                                                    <TextBlock Text="LOW" FontSize="10" Opacity="0.5"/>
                                                    <TextBlock x:Name="SpeedLowText" Text="-- Mbps" FontSize="12" FontWeight="Bold"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="HIGH" FontSize="10" Opacity="0.5"/>
                                                    <TextBlock x:Name="SpeedHighText" Text="-- Mbps" FontSize="12" FontWeight="Bold"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="2">
                                                    <TextBlock Text="AVG" FontSize="10" Opacity="0.5"/>
                                                    <TextBlock x:Name="SpeedAvgText" Text="-- Mbps" FontSize="12" FontWeight="Bold" Foreground="{StaticResource Brush.Primary}"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>

                                        <!-- Speed Graph -->
                                        <Grid Grid.Column="1">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            <TextBlock Text="Speed History (Mbps)" FontSize="12" Opacity="0.6" Margin="0,0,0,8"/>
                                            <Border Grid.Row="1" Height="100" Background="#08FFFFFF" CornerRadius="12" BorderBrush="#15FFFFFF" BorderThickness="1">
                                                <Canvas x:Name="SpeedCanvas">
                                                    <Polyline x:Name="SpeedPath" Stroke="{StaticResource Brush.Primary}" StrokeThickness="2" StrokeLineJoin="Round"/>
                                                    <Polyline x:Name="UploadPath" Stroke="#D279FF" StrokeThickness="2" StrokeLineJoin="Round" StrokeDashArray="2,1"/>
                                                </Canvas>
                                            </Border>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- Real-time Latency Graph -->
                                <Border Grid.Row="2" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="32" Margin="0,0,0,24">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="300"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <StackPanel Orientation="Horizontal" Spacing="24" Margin="0,0,0,24">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE9D2;" FontSize="20" Foreground="{StaticResource Brush.Primary}"/>
                                                <TextBlock Text="Latency Timeline (RTT)" Style="{StaticResource Text.Headline3}"/>
                                            </StackPanel>
                                            
                                            <!-- Legend -->
                                            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <Rectangle Width="12" Height="12" Fill="#0078D7"/>
                                                    <TextBlock Text="Expert (Quest)" FontSize="12" Opacity="0.8"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Graph Area -->
                                        <Grid Grid.Row="2" Margin="0,0,0,10">
                                            <!-- Y-Axis Labels -->
                                            <Grid VerticalAlignment="Stretch" HorizontalAlignment="Left" Width="40" Margin="0,0,10,0">
                                                <TextBlock Text="300ms" FontSize="10" Opacity="0.4" VerticalAlignment="Top"/>
                                                <TextBlock Text="200ms" FontSize="10" Opacity="0.4" Margin="0,100,0,0" VerticalAlignment="Top"/>
                                                <TextBlock Text="100ms" FontSize="10" Opacity="0.4" Margin="0,200,0,0" VerticalAlignment="Top"/>
                                                <TextBlock Text="0ms" FontSize="10" Opacity="0.4" VerticalAlignment="Bottom"/>
                                            </Grid>

                                            <!-- Grid Lines -->
                                            <Canvas Margin="40,0,0,0" Opacity="0.1" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                                <Line X1="0" Y1="0" X2="2000" Y2="0" Stroke="White" StrokeThickness="1"/>
                                                <Line X1="0" Y1="100" X2="2000" Y2="100" Stroke="White" StrokeThickness="1"/>
                                                <Line X1="0" Y1="200" X2="2000" Y2="200" Stroke="White" StrokeThickness="1"/>
                                                <Line X1="0" Y1="300" X2="2000" Y2="300" Stroke="White" StrokeThickness="1"/>
                                            </Canvas>

                                            <!-- Plot Layers -->
                                            <Canvas x:Name="LatencyCanvas" Margin="40,0,0,0" Background="Transparent" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                                <Polyline x:Name="UnityPath" Stroke="#0078D7" StrokeThickness="2" StrokeLineJoin="Round"/>
                                            </Canvas>
                                        </Grid>

                                        <!-- Stats Panel -->
                                        <Grid Grid.Row="3" Margin="40,16,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Quest Stats -->
                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="QUEST LATENCY" FontSize="11" FontWeight="Bold" Opacity="0.6" Foreground="#0078D7"/>
                                                <StackPanel Orientation="Horizontal" Spacing="16">
                                                    <StackPanel>
                                                        <TextBlock Text="MIN" FontSize="9" Opacity="0.4"/>
                                                        <TextBlock x:Name="QuestMinText" Text="-- ms" FontSize="13"/>
                                                    </StackPanel>
                                                    <StackPanel>
                                                        <TextBlock Text="MAX" FontSize="9" Opacity="0.4"/>
                                                        <TextBlock x:Name="QuestMaxText" Text="-- ms" FontSize="13"/>
                                                    </StackPanel>
                                                    <StackPanel>
                                                        <TextBlock Text="AVG" FontSize="9" Opacity="0.4"/>
                                                        <TextBlock x:Name="QuestAvgText" Text="-- ms" FontSize="13" FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </StackPanel>


                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- Node Discovery Section -->
                                <Border Grid.Row="3" Background="{StaticResource Brush.Background.Card}" CornerRadius="{StaticResource Radius.Medium}" Padding="32">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,24">
                                            <FontIcon Glyph="&#xE774;" FontSize="20" Foreground="#00CC6A"/>
                                            <TextBlock Text="Network Topology &amp; Node Discovery" Style="{StaticResource Text.Headline3}"/>
                                        </StackPanel>
                                        
                                        <Grid Grid.Row="1" ColumnSpacing="24">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Hub Node -->
                                            <StackPanel Grid.Column="0" Spacing="12">
                                                <TextBlock Text="LOCAL HUB (THIS PC)" FontSize="11" FontWeight="Bold" Opacity="0.6"/>
                                                <Border Background="#10FFFFFF" BorderBrush="#1AFFFFFF" BorderThickness="1" Padding="16" CornerRadius="12">
                                                    <StackPanel Spacing="6">
                                                        <TextBlock x:Name="HubIpText" Text="Checking..." FontSize="13" FontWeight="SemiBold"/>
                                                        <TextBlock x:Name="HubLocText" Text="Locating Hub..." FontSize="11" Opacity="0.5"/>
                                                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                                            <Ellipse Width="6" Height="6" Fill="#00CC6A"/>
                                                            <TextBlock x:Name="HubRelayText" Text="CONNECTED" FontSize="10" FontWeight="SemiBold" Foreground="#00CC6A"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>

                                            <!-- Expert Node -->
                                            <StackPanel Grid.Column="1" Spacing="12">
                                                <TextBlock Text="EXPERT (QUEST)" FontSize="11" FontWeight="Bold" Opacity="0.6"/>
                                                <Border Background="#10FFFFFF" BorderBrush="#1AFFFFFF" BorderThickness="1" Padding="16" CornerRadius="12">
                                                    <StackPanel Spacing="6">
                                                        <TextBlock x:Name="QuestIpText" Text="Searching..." FontSize="13" FontWeight="SemiBold"/>
                                                        <TextBlock x:Name="QuestLocText" Text="Tailscale Mesh" FontSize="11" Opacity="0.5"/>
                                                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                                            <Ellipse x:Name="QuestRelayDot" Width="6" Height="6" Fill="#0078D7"/>
                                                            <TextBlock x:Name="QuestRelayText" Text="DIRECT P2P" FontSize="10" FontWeight="SemiBold" Foreground="#0078D7"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>

                                            <!-- Robot 1 Node -->
                                            <StackPanel Grid.Column="2" Spacing="12">
                                                <TextBlock Text="ROBOT 1" FontSize="11" FontWeight="Bold" Opacity="0.6"/>
                                                <Border Background="#10FFFFFF" BorderBrush="#1AFFFFFF" BorderThickness="1" Padding="16" CornerRadius="12">
                                                    <StackPanel Spacing="6">
                                                        <TextBlock x:Name="R1IpText" Text="Disconnected" FontSize="13" FontWeight="SemiBold"/>
                                                        <TextBlock x:Name="R1LocText" Text="LAN / Ethernet" FontSize="11" Opacity="0.5"/>
                                                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                                            <Ellipse x:Name="R1RelayDot" Width="6" Height="6" Fill="{StaticResource Brush.Primary}"/>
                                                            <TextBlock x:Name="R1RelayText" Text="ROS BRIDGE" FontSize="10" FontWeight="SemiBold" Foreground="{StaticResource Brush.Primary}"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>

                                            <!-- Robot 2 Node -->
                                            <StackPanel Grid.Column="3" Spacing="12">
                                                <TextBlock Text="ROBOT 2" FontSize="11" FontWeight="Bold" Opacity="0.6"/>
                                                <Border Background="#10FFFFFF" BorderBrush="#1AFFFFFF" BorderThickness="1" Padding="16" CornerRadius="12">
                                                    <StackPanel Spacing="6">
                                                        <TextBlock x:Name="R2IpText" Text="Offline" FontSize="13" FontWeight="SemiBold"/>
                                                        <TextBlock x:Name="R2LocText" Text="N/A" FontSize="11" Opacity="0.5"/>
                                                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                                            <Ellipse x:Name="R2RelayDot" Width="6" Height="6" Fill="#808080"/>
                                                            <TextBlock x:Name="R2RelayText" Text="PENDING" FontSize="10" FontWeight="SemiBold" Opacity="0.8"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </Grid>
                        </ScrollViewer>
                    </Border>
                </Grid>



                <!-- 4. SETTINGS VIEW -->
                <Grid x:Name="SettingsView" Visibility="Collapsed">
                    <Border Padding="{StaticResource Padding.Page}">
                        <StackPanel Spacing="{StaticResource Space.24}" MaxWidth="600" HorizontalAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="16" Margin="0,0,0,12">
                                <Image Source="ms-appx:///Assets/AppLogo.png" Width="36" Height="36"/>
                                <TextBlock Text="Settings" Style="{StaticResource Text.Headline1}" VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Relay Settings -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Relay Server Port" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="RelayPortInput" PlaceholderText="5000" MinWidth="300"/>
                                <TextBlock Text="The internal port where the relay server listens." Style="{StaticResource Text.Caption}" Opacity="0.6"/>
                            </StackPanel>

                            <StackPanel Spacing="8">
                                <TextBlock Text="Hub Address (To use in Quest)" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="PublicUrlInput" PlaceholderText="http://yd-9s71544222:5000" MinWidth="300"/>
                                <TextBlock Text="The URL or IP where this laptop is reachable from the Quest." Style="{StaticResource Text.Caption}" Opacity="0.6"/>
                            </StackPanel>

                            <StackPanel Spacing="8">
                                <TextBlock Text="Expert / Quest IP Address (For Monitoring)" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="ExpertIpInput" PlaceholderText="quest-3" MinWidth="300"/>
                                <TextBlock Text="The IP of your Quest headset for proactive latency and health pings." Style="{StaticResource Text.Caption}" Opacity="0.6"/>
                            </StackPanel>

                            <!-- Robot Settings -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="Robot 1 IP Address (ROS Bridge)" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="RobotIpInput" PlaceholderText="ws://169.254.200.200:9090" MinWidth="300"/>
                            </StackPanel>

                            <StackPanel Spacing="8">
                                <TextBlock Text="Robot 2 IP Address (ROS Bridge)" Style="{StaticResource Text.Body1}"/>
                                <TextBox x:Name="Robot2IpInput" PlaceholderText="ws://169.254.200.201:9090" MinWidth="300"/>
                            </StackPanel>


                            
                            <Button x:Name="SaveSettingsButton" Content="SAVE &amp; RESTART HUB" Style="{StaticResource Button.Filled}" HorizontalAlignment="Left" Click="SaveSettingsButton_Click" Margin="0,16,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </NavigationView>
    </Grid>
</Window>
